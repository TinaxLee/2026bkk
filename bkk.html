<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Darren & Tina 2026 Honeymoon</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/833/833472.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F0EFEA; color: #4A4A4A; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .bg-gradient-custom { background: linear-gradient(135deg, #6B705C 0%, #A5A58D 100%); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { background-color: #6B705C; color: white; box-shadow: 0 10px 20px -5px rgba(107, 112, 92, 0.4); }
        .card-shadow { box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.05); }
        .grid-collapse { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .grid-collapse.open { grid-template-rows: 1fr; }
        .collapse-inner { overflow: hidden; }
        .arrow-rotate { transition: transform 0.4s ease; }
        .arrow-rotate.active { transform: rotate(180deg); }
        @keyframes heartBeat { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
        .heart-icon { display: inline-block; color: #E6BEBB; animation: heartBeat 2s infinite ease-in-out; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .text-morandi-blue { color: #8A9AAB; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, collection, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

        // å¦³çš„å°ˆå±¬ Config
        const firebaseConfig = {
            apiKey: "AIzaSyBxcDDn80ScpW35TdJdeXOAkfJbHM0DyD0",
            authDomain: "honeymoon-2026.firebaseapp.com",
            projectId: "honeymoon-2026",
            storageBucket: "honeymoon-2026.firebasestorage.app",
            messagingSenderId: "639168649822",
            appId: "1:639168649822:web:20399eff7d34144277f2cf",
            measurementId: "G-5MDQVLDS7P"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let userId = null;
        let exchangeRate = 0.95;

        // 1. è‡ªå‹•æŠ“å–åŒ¯ç‡
        const fetchRate = async () => {
            try {
                const res = await fetch('https://api.frankfurter.dev/v1/latest?base=THB&symbols=TWD');
                const data = await res.json();
                if(data?.rates?.TWD) exchangeRate = data.rates.TWD;
            } catch(e) { console.log("ä½¿ç”¨é è¨­åŒ¯ç‡"); }
        };

        // 2. èº«ä»½èˆ‡åŒæ­¥
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                fetchRate().then(startSyncing);
            } else {
                signInAnonymously(auth);
            }
        });

        // å®šç¾©è³‡æ–™è·¯å¾‘ (ç¢ºä¿ Tina å’Œ Darren çœ‹åˆ°åŒä¸€ä»½)
        const getColl = (name) => collection(db, 'honeymoon_data', 'shared', name);
        const getMeta = () => doc(db, 'honeymoon_data', 'shared', 'meta', 'info');

        function startSyncing() {
            onSnapshot(getMeta(), (d) => {
                if (d.exists()) {
                    const data = d.data();
                    if (document.activeElement.id !== 'flight-text') document.getElementById('flight-text').value = data.flight || '';
                    if (document.activeElement.id !== 'hotel-text') document.getElementById('hotel-text').value = data.hotel || '';
                }
            });

            onSnapshot(getColl('itinerary'), (s) => renderItinerary(s.docs.map(d => ({id: d.id, ...d.data()}))));
            onSnapshot(getColl('packing'), (s) => renderPacking(s.docs.map(d => ({id: d.id, ...d.data()}))));
            onSnapshot(getColl('expenses'), (s) => renderExpenses(s.docs.map(d => ({id: d.id, ...d.data()}))));
        }

        // 3. è¦–çª—åŠŸèƒ½
        window.saveMeta = async (key) => {
            const val = document.getElementById(key + '-text').value;
            await setDoc(getMeta(), { [key]: val }, { merge: true });
        };

        window.addItinerary = async () => {
            const act = document.getElementById('it-activity').value;
            if(!act) return;
            await addDoc(getColl('itinerary'), {
                day: document.getElementById('it-day').value || 'Day 1',
                time: document.getElementById('it-time').value || '--:--',
                activity: act,
                createdAt: Date.now()
            });
            document.getElementById('it-activity').value = '';
        };

        window.addPacking = async () => {
            const val = document.getElementById('pack-item').value;
            if(!val) return;
            await addDoc(getColl('packing'), {
                item: val,
                owner: document.getElementById('pack-owner').value,
                checked: false,
                createdAt: Date.now()
            });
            document.getElementById('pack-item').value = '';
        };

        window.togglePack = async (id, status) => {
            await updateDoc(doc(db, 'honeymoon_data', 'shared', 'packing', id), { checked: !status });
        };

        window.addExpense = async () => {
            const item = document.getElementById('exp-item').value;
            const cost = document.getElementById('exp-cost').value;
            if(!item || !cost) return;
            await addDoc(getColl('expenses'), {
                item, cost: parseFloat(cost),
                currency: document.getElementById('exp-currency').value,
                payer: document.getElementById('exp-payer').value,
                createdAt: Date.now()
            });
            document.getElementById('exp-item').value = '';
            document.getElementById('exp-cost').value = '';
        };

        window.deleteItem = async (coll, id) => {
            await deleteDoc(doc(db, 'honeymoon_data', 'shared', coll, id));
        };

        // --- Render ---
        function renderItinerary(items) {
            document.getElementById('it-list').innerHTML = items.sort((a,b)=>a.day.localeCompare(b.day)||a.time.localeCompare(b.time)).map(item => `
                <div class="bg-white p-6 rounded-[2rem] border border-[#EBEBEB] flex gap-5 items-center relative card-shadow fade-in">
                    <div class="flex flex-col items-center bg-[#F5F5F3] p-3 rounded-2xl min-w-[65px]">
                        <span class="text-[9px] font-black text-[#A5A5A5] tracking-tighter uppercase">${item.day}</span>
                        <span class="text-sm font-black text-[#6B705C]">${item.time}</span>
                    </div>
                    <div class="flex-1">
                        <div class="font-bold text-[#4A4E40] text-sm">${item.activity}</div>
                        <button onclick="window.open('https://www.google.com/maps/search/${encodeURIComponent(item.activity)}', '_blank')" class="text-[9px] font-black text-[#8E9775] mt-2 opacity-70 uppercase tracking-[0.1em] border border-[#8E9775]/20 px-3 py-1 rounded-full">ğŸ“ å°èˆª</button>
                    </div>
                    <button onclick="deleteItem('itinerary', '${item.id}')" class="text-[#DDD] px-2">âœ•</button>
                </div>
            `).join('');
        }

        function renderPacking(items) {
            const draw = (owner, tid) => {
                const list = items.filter(i => i.owner === owner);
                const color = owner === 'tina' ? '#E6BEBB' : '#8A9AAB';
                document.getElementById(tid).innerHTML = list.length ? list.map(i => `
                    <div onclick="togglePack('${i.id}', ${i.checked})" class="p-5 flex items-center gap-4 border-b border-[#F9F9F7] active:bg-gray-50 transition-colors cursor-pointer">
                        <div class="w-5 h-5 rounded-md border-2 flex items-center justify-center" style="background-color: ${i.checked ? color : 'transparent'}; border-color: ${i.checked ? color : '#DDD'}">
                            ${i.checked ? '<span class="text-white text-xs">âœ“</span>' : ''}
                        </div>
                        <span class="flex-1 font-bold text-sm ${i.checked ? 'line-through text-[#CCC]' : 'text-[#4A4A4A]'}">${i.item}</span>
                        <button onclick="event.stopPropagation(); deleteItem('packing', '${i.id}')" class="text-[#DDD] px-2 text-xs">âœ•</button>
                    </div>
                `).join('') : '<p class="p-5 text-center text-[10px] text-[#DDD] font-bold">å°šæœªå¡«å¯«</p>';
            };
            draw('tina', 'pk-list-tina');
            draw('darren', 'pk-list-darren');
        }

        function renderExpenses(items) {
            let total = 0, tinaSum = 0, darrenSum = 0;
            const html = items.map(exp => {
                const twd = exp.currency === 'THB' ? exp.cost * exchangeRate : exp.cost;
                total += twd;
                if(exp.payer === 'tina') tinaSum += twd; else darrenSum += twd;
                return `
                    <div class="bg-white p-5 rounded-3xl flex justify-between items-center card-shadow fade-in">
                        <div class="flex items-center gap-3">
                            <div class="w-1.5 h-8 rounded-full" style="background-color: ${exp.payer === 'tina' ? '#E6BEBB' : '#8A9AAB'}"></div>
                            <div>
                                <div class="text-sm font-bold text-[#4A4E40]">${exp.item}</div>
                                <div class="text-[9px] text-[#A5A5A5] font-black uppercase">${exp.payer.toUpperCase()} æ”¯ä»˜</div>
                            </div>
                        </div>
                        <div class="text-right flex items-center gap-4">
                            <span class="text-base font-black text-[#6B705C] font-mono">${exp.currency === 'THB' ? 'à¸¿' : '$'} ${exp.cost.toLocaleString()}</span>
                            <button onclick="deleteItem('expenses', '${exp.id}')" class="text-[#DDD] px-1">âœ•</button>
                        </div>
                    </div>`;
            }).join('');
            document.getElementById('exp-list').innerHTML = html;
            document.getElementById('total-twd').innerText = 'NT$ ' + Math.round(total).toLocaleString();
            document.getElementById('current-rate-display').innerText = `ç›®å‰åŒ¯ç‡ 1 à¸¿ = ${exchangeRate.toFixed(3)} NT$`;
            document.getElementById('tina-paid').innerText = 'NT$ ' + Math.round(tinaSum).toLocaleString();
            document.getElementById('darren-paid').innerText = 'NT$ ' + Math.round(darrenSum).toLocaleString();
        }
    </script>
</head>

<body class="pb-40">
    <div class="fixed -top-20 -left-20 w-72 h-72 rounded-full bg-[#E6BEBB] opacity-20 blur-3xl pointer-events-none"></div>

    <header class="bg-white/80 backdrop-blur-xl border-b border-white/50 p-8 sticky top-0 z-30 text-center">
        <div class="max-w-md mx-auto">
            <div class="flex justify-center items-center gap-3 mb-1">
                <span class="heart-icon text-xs">â™¥</span>
                <span class="text-[9px] font-black text-[#A5A58D] tracking-[0.5em] uppercase">Sweet Getaway</span>
                <span class="heart-icon text-xs">â™¥</span>
            </div>
            <h1 class="text-3xl font-black tracking-[0.1em] text-[#4A4E40] uppercase">Darren <span class="text-[#8E9775] font-light">&</span> Tina</h1>
            <p class="text-[10px] font-bold text-[#8E9775] mt-2 tracking-[0.2em] uppercase">2026 æ›¼è°· + æ™®å‰å³¶ èœœæœˆè¨ˆç•«</p>
            
            <div class="flex gap-3 mt-8 overflow-x-auto justify-center no-scrollbar" id="tabs">
                <button onclick="switchTab('itinerary')" id="tab-itinerary" class="px-7 py-2.5 rounded-full text-[11px] font-black tab-active">ğŸ—ºï¸ è¡Œç¨‹</button>
                <button onclick="switchTab('packing')" id="tab-packing" class="px-7 py-2.5 rounded-full text-[11px] font-black bg-white text-[#A5A5A5]">ğŸ’ æ¸…å–®</button>
                <button onclick="switchTab('budget')" id="tab-budget" class="px-7 py-2.5 rounded-full text-[11px] font-black bg-white text-[#A5A5A5]">ğŸ’° é ç®—</button>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-6 space-y-6">
        <div id="content-itinerary" class="tab-content space-y-6 fade-in">
            <div class="bg-white rounded-[2rem] card-shadow border border-white/60 overflow-hidden">
                <button onclick="toggleSection('flight')" class="w-full p-6 flex justify-between items-center bg-[#6B705C] text-white">
                    <span class="font-black text-xs tracking-[0.2em]">âœˆï¸ èˆªç­è³‡è¨Š</span>
                    <svg id="flight-arrow" class="arrow-rotate w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                </button>
                <div id="flight-grid" class="grid-collapse"><div class="collapse-inner p-6">
                    <textarea id="flight-text" oninput="saveMeta('flight')" placeholder="å¡«å…¥èˆªç­æ™‚é–“..." class="w-full h-32 bg-[#F9F9F7] p-5 rounded-[1.5rem] text-sm font-bold border-none outline-none shadow-inner"></textarea>
                </div></div>
            </div>
            
            <div class="bg-white rounded-[2rem] card-shadow border border-white/60 overflow-hidden">
                <button onclick="toggleSection('hotel')" class="w-full p-6 flex justify-between items-center bg-[#DDB892] text-white">
                    <span class="font-black text-xs tracking-[0.2em]">ğŸ¨ ä½å®¿å®‰æ’</span>
                    <svg id="hotel-arrow" class="arrow-rotate w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                </button>
                <div id="hotel-grid" class="grid-collapse"><div class="collapse-inner p-6">
                    <textarea id="hotel-text" oninput="saveMeta('hotel')" placeholder="å¡«å…¥é£¯åº—è³‡è¨Š..." class="w-full h-32 bg-[#F9F9F7] p-5 rounded-[1.5rem] text-sm font-bold border-none outline-none shadow-inner"></textarea>
                </div></div>
            </div>

            <div class="bg-white p-7 rounded-[2.5rem] card-shadow border border-white">
                <h2 class="text-[#4A4E40] font-black text-sm mb-6 text-center">ä¸‹ä¸€ç«™å»å“ªï¼Ÿ âœ¨</h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <input type="text" id="it-day" placeholder="Day 1" class="w-full bg-[#F9F9F7] p-4 rounded-2xl text-xs font-bold border-none outline-none">
                    <input type="time" id="it-time" class="w-full bg-[#F9F9F7] p-4 rounded-2xl text-xs font-black border-none outline-none text-[#6B705C]">
                </div>
                <input type="text" id="it-activity" placeholder="ä¾‹å¦‚ï¼šæ™®å‰å³¶å¤•é™½æ™šé¤ ğŸ¥‚" class="w-full bg-[#F9F9F7] p-4 rounded-2xl text-sm font-bold border-none outline-none shadow-inner mb-6">
                <button onclick="addItinerary()" class="bg-[#8E9775] text-white w-full py-4 rounded-2xl font-black text-xs tracking-[0.2em] shadow-lg active:scale-95">åŠ å…¥è¨ˆç•«</button>
            </div>
            <div id="it-list" class="space-y-4"></div>
        </div>

        <div id="content-packing" class="tab-content hidden space-y-6 fade-in">
            <div class="bg-white p-6 rounded-[2.5rem] card-shadow space-y-4 border border-white">
                <div class="flex gap-2">
                    <input type="text" id="pack-item" placeholder="éœ€è¦å¸¶ä»€éº¼..." class="bg-[#F9F9F7] p-4 rounded-2xl flex-1 text-sm font-bold border-none outline-none shadow-inner">
                    <select id="pack-owner" class="bg-[#F9F9F7] px-4 rounded-2xl text-xs font-black text-[#6B705C] border-none outline-none">
                        <option value="tina">Tina</option>
                        <option value="darren">Darren</option>
                    </select>
                </div>
                <button onclick="addPacking()" class="bg-[#6B705C] text-white w-full py-4 rounded-2xl font-black text-xs active:scale-95">æ–°å¢</button>
            </div>
            <div class="space-y-6">
                <div><p class="text-[10px] font-black text-[#E6BEBB] tracking-widest uppercase ml-4 mb-3">For Tina</p>
                    <div id="pk-list-tina" class="bg-white rounded-[2rem] card-shadow border border-[#E6BEBB]/10 overflow-hidden"></div>
                </div>
                <div><p class="text-[10px] font-black text-morandi-blue tracking-widest uppercase ml-4 mb-3">For Darren</p>
                    <div id="pk-list-darren" class="bg-white rounded-[2rem] card-shadow border-[#8A9AAB]/10 overflow-hidden"></div>
                </div>
            </div>
        </div>

        <div id="content-budget" class="tab-content hidden space-y-6 fade-in">
            <div class="bg-gradient-custom rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden text-center">
                <div class="absolute -top-10 -right-10 text-[10rem] opacity-10 pointer-events-none rotate-12">ğŸ¥¥</div>
                <p class="text-white/60 text-[10px] tracking-[0.4em] mb-2 uppercase font-black">èœœæœˆç¸½æ”¯å‡º</p>
                <div id="total-twd" class="text-5xl font-black mb-2 tracking-tighter">NT$ 0</div>
                <p id="current-rate-display" class="text-white/40 text-[8px] font-black mb-10 tracking-widest">è¼‰å…¥åŒ¯ç‡ä¸­...</p>
                <div class="grid grid-cols-2 gap-4 pt-6 border-t border-white/10">
                    <div><p class="text-white/40 text-[8px] font-black mb-1 uppercase">Tina æ”¯ä»˜</p><p id="tina-paid" class="text-sm font-black font-mono">NT$ 0</p></div>
                    <div><p class="text-white/40 text-[8px] font-black mb-1 uppercase">Darren æ”¯ä»˜</p><p id="darren-paid" class="text-sm font-black font-mono">NT$ 0</p></div>
                </div>
            </div>
            <div class="bg-white p-8 rounded-[2.5rem] card-shadow space-y-4 border border-white">
                <input type="text" id="exp-item" placeholder="æ¶ˆè²»é …ç›®..." class="w-full bg-[#F9F9F7] p-4 rounded-2xl border-none outline-none text-sm font-bold shadow-inner">
                <div class="flex gap-2">
                    <input type="number" id="exp-cost" placeholder="é‡‘é¡" class="flex-1 bg-[#F9F9F7] p-4 rounded-2xl border-none font-mono font-black shadow-inner">
                    <select id="exp-currency" class="bg-[#F9F9F7] px-4 rounded-2xl border-none font-black text-[#6B705C]"><option value="THB">à¸¿ æ³°éŠ–</option><option value="TWD">$ å°å¹£</option></select>
                    <select id="exp-payer" class="bg-[#F9F9F7] px-4 rounded-2xl border-none font-black text-[#6B705C]"><option value="tina">Tina åˆ·</option><option value="darren">Darren åˆ·</option></select>
                </div>
                <button onclick="addExpense()" class="bg-[#DDB892] text-white w-full py-4 rounded-2xl font-black text-xs active:scale-95 transition-all">åŒæ­¥èŠ±è²»</button>
            </div>
            <div id="exp-list" class="space-y-3"></div>
        </div>
    </main>

    <nav class="fixed bottom-8 left-8 right-8 bg-[#4A4E40]/90 backdrop-blur-2xl rounded-[2.5rem] py-5 px-10 flex justify-around items-center z-50 shadow-2xl border border-white/10">
        <button onclick="switchTab('itinerary')" class="text-2xl hover:scale-125 transition-all">ğŸ—ºï¸</button>
        <button onclick="switchTab('packing')" class="text-2xl hover:scale-125 transition-all">ğŸ’</button>
        <button onclick="switchTab('budget')" class="text-2xl hover:scale-125 transition-all">ğŸ’°</button>
    </nav>

    <script>
        function toggleSection(id) { 
            document.getElementById(id+'-grid').classList.toggle('open'); 
            document.getElementById(id+'-arrow').classList.toggle('active'); 
        }
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('content-'+id).classList.remove('hidden');
            document.querySelectorAll('#tabs button').forEach(b => b.className = "px-7 py-2.5 rounded-full text-[11px] font-black bg-white text-[#A5A5A5]");
            document.getElementById('tab-'+id).className = "px-7 py-2.5 rounded-full text-[11px] font-black tab-active";
        }
    </script>
</body>
</html>
