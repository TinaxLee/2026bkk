<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Darren & Tina 2026 Honeymoon</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&family=Montserrat:wght@400;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --morandi-olive: #6B705C;
            --morandi-beige: #B7B7A4;
            --morandi-gold: #DDB892;
            --morandi-text: #4A4E40;
            --bg-light: #F0EFEA;
            --heart-pink: #F8AD9D;
        }

        body { 
            font-family: 'Montserrat', 'Noto Sans TC', sans-serif; 
            background-color: var(--bg-light); 
            color: var(--morandi-text); 
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            overflow-y: auto;
        }

        .heart-text { color: var(--heart-pink); font-size: 0.8rem; letter-spacing: 0.4em; font-weight: 800; margin-bottom: 0.5rem; }
        .couple-name { 
            font-family: 'Playfair Display', serif; 
            font-size: 2.2rem; 
            line-height: 1.1; 
            font-weight: 700; 
            color: #2D3128; 
            margin: 0.5rem 0; 
        }
        
        .main-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 50;
        }

        .app-card {
            background: white;
            border-radius: 1.2rem;
            box-shadow: 0 4px 12px -5px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.8);
        }

        .bottom-nav {
            background: rgba(74, 78, 64, 0.95);
            backdrop-filter: blur(15px);
            position: fixed;
            bottom: 25px; left: 15px; right: 15px;
            border-radius: 2rem;
            height: 60px;
            z-index: 1000;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .nav-btn { font-size: 1.1rem; cursor: pointer; transition: opacity 0.2s; padding: 10px; }
        .btn-press:active { transform: scale(0.95); }

        .expand-panel { display: none; margin-top: 10px; }
        .expand-panel.active { display: block; }

        #gemini-modal {
            position: fixed; inset: 0; z-index: 2000;
            background: rgba(0,0,0,0.3);
            visibility: hidden; opacity: 0; transition: opacity 0.3s ease;
        }
        #gemini-modal.open { visibility: visible; opacity: 1; }
        #gemini-panel {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 85%; background: #F8F7F2; border-radius: 2rem 2rem 0 0;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1);
        }
        #gemini-modal.open #gemini-panel { transform: translateY(0); }

        .tag { font-size: 10px; font-weight: 900; padding: 2px 8px; border-radius: 6px; margin-right: 4px; display: inline-block; margin-bottom: 4px; }
        .tag-food { background: #E9EDC9; color: #6B705C; border: 1px solid #D4D9A1; }
        .tag-buy { background: #FEF3C7; color: #92400E; border: 1px solid #FDE68A; }
        .tag-important { background: #FEE2E2; color: #B91C1C; border: 1px solid #FECACA; }
        .tag-type { background: #F3F4F6; color: #4B5563; border: 1px solid #E5E7EB; }

        input, select, textarea { font-size: 16px !important; } 

        .filter-chip {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            background: white;
            border: 1px solid #E5E7EB;
            color: #9CA3AF;
            transition: all 0.2s;
        }
        .filter-chip.active {
            background: #6B705C;
            border-color: #6B705C;
            color: white;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, collection, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

        let firebaseConfig = {};
        try {
            firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        } catch (e) { console.error("Firebase config error", e); }

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'darren-tina-honeymoon-2026';
        let app, auth, db, currentUser = null;
        let allExpenses = []; 
        let currentPayerFilter = 'all'; 

        if (firebaseConfig.apiKey) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            const initAuth = async () => {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else { await signInAnonymously(auth); }
            };
            onAuthStateChanged(auth, (user) => { if (user) { currentUser = user; startSyncing(); } else { initAuth(); } });
        }

        const getColl = (n) => collection(db, 'artifacts', appId, 'public', 'data', n);

        function startSyncing() {
            onSnapshot(getColl('itinerary'), (s) => renderItinerary(s.docs.map(d => ({id: d.id, ...d.data()}))));
            onSnapshot(getColl('packing'), (s) => renderPacking(s.docs.map(d => ({id: d.id, ...d.data()}))));
            onSnapshot(getColl('expenses'), (s) => {
                allExpenses = s.docs.map(d => ({id: d.id, ...d.data()}));
                renderExpenses();
            });
            onSnapshot(getColl('flights'), (s) => renderFlights(s.docs.map(d => ({id: d.id, ...d.data()}))));
            onSnapshot(getColl('hotels'), (s) => renderHotels(s.docs.map(d => ({id: d.id, ...d.data()}))));
        }

        // --- èˆªç­ç®¡ç† ---
        function renderFlights(items) {
            const list = document.getElementById('flights-list');
            if (items.length === 0) {
                list.innerHTML = `<p class="text-[10px] text-gray-300 text-center py-8 italic">é‚„æ²’æœ‰èˆªç­è³‡è¨Šå–” âœˆï¸</p>`;
                return;
            }
            list.innerHTML = items.map(f => `
                <div class="app-card p-4 mb-3 flex justify-between items-center">
                    <div>
                        <div class="text-xs font-black text-[#6B705C]">${f.code} <span class="text-[10px] text-gray-300 ml-1">${f.time}</span></div>
                        <div class="text-[10px] text-gray-400 font-bold">${f.from} â†’ ${f.to} | Gate: ${f.gate || '--'}</div>
                    </div>
                    <button onclick="deleteItem('flights', '${f.id}')" class="text-gray-200 text-xs">âœ•</button>
                </div>
            `).join('');
        }

        window.addFlight = async () => {
            const code = document.getElementById('f-code').value;
            if (!code || !currentUser) return;
            await addDoc(getColl('flights'), {
                code, from: document.getElementById('f-from').value,
                to: document.getElementById('f-to').value,
                time: document.getElementById('f-time').value,
                gate: document.getElementById('f-gate').value,
                seat: document.getElementById('f-seat').value
            });
            document.getElementById('f-code').value = '';
            toggleSection('flight');
        };

        // --- é£¯åº—ç®¡ç† ---
        function renderHotels(items) {
            const list = document.getElementById('hotels-list');
            if (items.length === 0) {
                list.innerHTML = `<p class="text-[10px] text-gray-300 text-center py-8 italic">é‚„æ²’æœ‰ä½å®¿è³‡è¨Šå–” ğŸ›Œ</p>`;
                return;
            }
            list.innerHTML = items.map(h => `
                <div class="app-card p-4 mb-3 flex justify-between items-center">
                    <div class="flex-1 pr-4">
                        <div class="text-xs font-black text-[#4A4E40] truncate">${h.name}</div>
                        <div class="text-[10px] text-gray-400 font-bold">${h.checkin} | ${h.room}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="window.open('https://www.google.com/maps/search/${encodeURIComponent(h.name)}')" class="text-[10px] text-[#DDB892] font-black underline">åœ°åœ–</button>
                        <button onclick="deleteItem('hotels', '${h.id}')" class="text-gray-200 text-xs">âœ•</button>
                    </div>
                </div>
            `).join('');
        }

        window.addHotel = async () => {
            const name = document.getElementById('h-name').value;
            if (!name || !currentUser) return;
            await addDoc(getColl('hotels'), {
                name, room: document.getElementById('h-room').value,
                checkin: document.getElementById('h-checkin').value
            });
            document.getElementById('h-name').value = '';
            toggleSection('hotel');
        };

        // --- è¡Œç¨‹ç®¡ç† ---
        const guideAnalyze = (text) => {
            let tagsHtml = "";
            if (/(é ç´„|ä»£è™Ÿ|ç·¨è™Ÿ|Code|è¨‚å–®)/.test(text)) tagsHtml += `<span class="tag tag-important">é‡è¦é ç´„ ğŸ“</span>`;
            if (/(åƒ|é¤å»³|ç¾é£Ÿ|å¿…åƒ)/.test(text)) tagsHtml += `<span class="tag tag-food">å¿…é»èœå–® ğŸ´</span>`;
            if (/(è²·|è³¼ç‰©|é€›|å¿…è²·)/.test(text)) tagsHtml += `<span class="tag tag-buy">å¿…è²·æ¸…å–® ğŸ›ï¸</span>`;
            return { tagsHtml };
        };

        const typeToLabel = (type) => {
            const labels = {
                'view': 'ğŸ“¸ æ™¯é»',
                'food': 'ğŸ´ ç¾é£Ÿ',
                'massage': 'ğŸ’† æŒ‰æ‘©',
                'shop': 'ğŸ›ï¸ è³¼ç‰©'
            };
            return labels[type] || 'ğŸ“ è¡Œç¨‹';
        };

        function renderItinerary(items) {
            document.getElementById('it-list').innerHTML = items.sort((a,b)=>a.day.localeCompare(b.day)||a.time.localeCompare(b.time)).map(item => {
                const analysis = guideAnalyze(item.activity);
                const typeLabel = typeToLabel(item.type);
                return `
                <div class="app-card p-4 flex gap-4 items-start mb-3 animate-in fade-in slide-in-from-right-4 duration-300">
                    <div class="flex flex-col items-center bg-[#F5F5F3] p-2 rounded-lg min-w-[55px]">
                        <span class="text-[9px] font-bold text-gray-400">${item.day}</span>
                        <span class="text-sm font-black text-[#6B705C]">${item.time}</span>
                    </div>
                    <div class="flex-1">
                        <div class="mb-1">
                            <span class="tag tag-type">${typeLabel}</span>
                            ${analysis.tagsHtml}
                        </div>
                        <div class="font-bold text-[#4A4E40] text-sm mb-2">${item.activity}</div>
                        <div class="flex gap-2">
                            <a href="https://www.google.com/maps/search/${encodeURIComponent(item.activity)}" target="_blank" class="flex-1 bg-[#8E9775] text-white text-[10px] py-1.5 rounded-lg text-center">å°èˆª</a>
                            <button onclick="smartGuide('${item.activity.replace(/'/g, "\\'")}')" class="flex-1 bg-[#DDB892] text-white text-[10px] py-1.5 rounded-lg text-center">æ”»ç•¥</button>
                        </div>
                    </div>
                    <button onclick="deleteItem('itinerary', '${item.id}')" class="text-gray-200">âœ•</button>
                </div>`;
            }).join('');
        }

        // --- é ç®—èˆ‡åˆ†å¸³çµ±è¨ˆ ---
        window.setPayerFilter = (payer) => {
            currentPayerFilter = payer;
            document.querySelectorAll('.filter-chip').forEach(el => {
                el.classList.toggle('active', el.id === 'chip-' + payer);
            });
            renderExpenses();
        };

        function renderExpenses() {
            let totalToDisplay = 0;
            let filteredExpenses = allExpenses;
            let tinaTotal = 0;
            let darrenTotal = 0;
            
            // è¨ˆç®—å„åˆ¥ç¸½é¡
            allExpenses.forEach(exp => {
                const costVal = exp.currency === 'THB' ? exp.cost : exp.cost / 0.95;
                if (exp.payer === 'tina') tinaTotal += costVal;
                else darrenTotal += costVal;
            });

            // æ›´æ–°æŒ‰éˆ•æ¨™ç±¤
            document.getElementById('chip-tina-amt').innerText = 'à¸¿' + Math.round(tinaTotal).toLocaleString();
            document.getElementById('chip-darren-amt').innerText = 'à¸¿' + Math.round(darrenTotal).toLocaleString();

            // åŸ·è¡Œéæ¿¾
            if (currentPayerFilter !== 'all') {
                filteredExpenses = allExpenses.filter(e => e.payer === currentPayerFilter);
                totalToDisplay = currentPayerFilter === 'tina' ? tinaTotal : darrenTotal;
                document.getElementById('total-label').innerText = currentPayerFilter === 'tina' ? "Tina's Total" : "Darren's Total";
            } else {
                totalToDisplay = tinaTotal + darrenTotal;
                document.getElementById('total-label').innerText = "Total Honeymoon Budget";
            }

            document.getElementById('exp-list').innerHTML = filteredExpenses.map(exp => {
                const payerLabel = exp.payer === 'tina' ? 'Tina ğŸ’°' : 'Darren ğŸ’³';
                return `
                <div class="app-card p-3 flex justify-between items-center mb-2 animate-in fade-in slide-in-from-bottom-2 duration-300">
                    <div class="text-xs font-bold text-[#4A4E40]">${exp.item} <span class="text-[10px] text-gray-300 font-normal ml-1">${payerLabel}</span></div>
                    <div class="text-xs font-black text-[#6B705C]">${exp.currency === 'THB' ? 'à¸¿' : '$'}${exp.cost.toLocaleString()} <button onclick="deleteItem('expenses', '${exp.id}')" class="text-gray-200 ml-2">âœ•</button></div>
                </div>`;
            }).join('');
            
            document.getElementById('total-amount').innerText = 'à¸¿ ' + Math.round(totalToDisplay).toLocaleString();
        }

        window.calcExchange = (val) => {
            const result = document.getElementById('exchange-result');
            if(!val) { result.innerText = '$ 0'; return; }
            result.innerText = '$ ' + Math.round(val * 0.95).toLocaleString();
        };

        // --- ç‰©å“æº–å‚™ ---
        function renderPacking(items) {
            const draw = (owner, tid) => {
                const el = document.getElementById(tid);
                if (!el) return;
                const list = items.filter(i => i.owner === owner);
                el.innerHTML = list.map(i => `
                    <div class="p-3 flex items-center gap-3 border-b border-gray-50">
                        <div onclick="togglePack('${i.id}', ${i.checked})" class="w-4 h-4 rounded border cursor-pointer ${i.checked ? 'bg-[#6B705C] border-[#6B705C]' : 'border-gray-200'}"></div>
                        <span class="flex-1 text-xs ${i.checked ? 'line-through text-gray-300' : 'font-bold'}">${i.item}</span>
                        <button onclick="deleteItem('packing', '${i.id}')" class="text-gray-200">âœ•</button>
                    </div>`).join('');
            };
            draw('tina', 'pk-list-tina');
            draw('darren', 'pk-list-darren');
        }

        // --- å…¨åŸŸè³‡æ–™æ“ä½œ ---
        window.deleteItem = async (c, id) => { if(currentUser) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', c, id)); };
        window.togglePack = async (id, s) => { if(currentUser) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'packing', id), { checked: !s }); };
        
        window.addItinerary = async () => {
            const act = document.getElementById('it-activity').value;
            const type = document.getElementById('it-type').value;
            if(!act || !currentUser) return;
            await addDoc(getColl('itinerary'), { 
                day: document.getElementById('it-day').value || 'Day 1', 
                time: document.getElementById('it-time').value || '12:00', 
                activity: act, 
                type: type 
            });
            document.getElementById('it-activity').value = '';
        };

        window.addExpense = async () => {
            const item = document.getElementById('exp-item').value;
            const cost = document.getElementById('exp-cost').value;
            if(!item || !cost || !currentUser) return;
            await addDoc(getColl('expenses'), { 
                item, 
                cost: parseFloat(cost), 
                currency: document.getElementById('exp-currency').value, 
                payer: document.getElementById('exp-payer').value 
            });
            document.getElementById('exp-item').value = ''; 
            document.getElementById('exp-cost').value = '';
        };

        window.addPacking = async () => {
            const val = document.getElementById('pack-item').value;
            if(!val || !currentUser) return;
            await addDoc(getColl('packing'), { item: val, owner: document.getElementById('pack-owner').value, checked: false });
            document.getElementById('pack-item').value = '';
        };

        // --- Gemini AI æ•´åˆ ---
        window.smartGuide = (place) => {
            window.toggleGemini(true);
            document.getElementById('gemini-input').value = `åˆ†æã€Œ${place}ã€çš„èœœæœˆæ”»ç•¥ï¼šæ™¯é»æ•…äº‹ã€æ¨è–¦ç¾é£Ÿã€æœ€ä½³æ‹ç…§ä½ç½®ã€‚`;
            window.askGemini();
        };

        window.clearGemini = () => { document.getElementById('gemini-chat').innerHTML = ''; };

        window.askGemini = async () => {
            const input = document.getElementById('gemini-input');
            const chat = document.getElementById('gemini-chat');
            const query = input.value.trim();
            if(!query) return;
            input.value = '';
            chat.innerHTML += `<div class="mb-4 text-right"><span class="inline-block bg-[#6B705C] text-white p-2 rounded-lg text-xs">${query}</span></div>`;
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `ä½ æ˜¯èœœæœˆåŠ©ç†ï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡ï¼š${query}` }] }] })
                });
                const data = await res.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "æŠ±æ­‰ï¼ŒåŠ©ç†å¿™ç·šä¸­ã€‚";
                chat.innerHTML += `<div class="mb-4 text-left"><div class="inline-block bg-white p-3 rounded-lg text-xs shadow-sm border">${text.replace(/\n/g, '<br>')}</div></div>`;
            } catch (e) { chat.innerHTML += `<div class="text-red-400 text-xs">Error</div>`; }
            chat.scrollTop = chat.scrollHeight;
        };

        window.switchTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('content-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.add('opacity-30'));
            document.getElementById('btn-'+id).classList.remove('opacity-30');
        };

        window.toggleSection = (id) => { document.getElementById(id+'-grid').classList.toggle('active'); };
        window.toggleGemini = (f = false) => { const m = document.getElementById('gemini-modal'); if(f) m.classList.add('open'); else m.classList.toggle('open'); };
    </script>
</head>
<body class="pb-24">
    <header class="main-header">
        <p class="heart-text">â™¥ SWEET GETAWAY â™¥</p>
        <h1 class="couple-name">DARREN <span class="italic font-serif">&</span> TINA</h1>
        <p class="text-[10px] font-bold text-[#6B705C] tracking-widest uppercase">2026 Bangkok & Phuket</p>
    </header>

    <main class="max-w-md mx-auto p-4">
        
        <!-- åˆ†é ï¼šæ©Ÿç¥¨é£¯åº— (Core) -->
        <div id="content-core" class="tab-content hidden">
            <div class="flex justify-between items-center mb-3 px-1">
                <h3 class="text-sm font-black text-[#4A4E40]">èˆªç­è³‡è¨Š âœˆï¸</h3>
                <button onclick="toggleSection('flight')" class="text-[10px] bg-[#6B705C] text-white px-3 py-1 rounded-full font-bold">ï¼‹æ–°å¢èˆªç­</button>
            </div>
            
            <div id="flight-grid" class="expand-panel app-card p-4 mb-4 bg-gray-50 border-2 border-dashed border-[#6B705C]">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" id="f-code" placeholder="èˆªç­è™Ÿ" class="p-2 text-xs rounded-lg border outline-none">
                    <input type="text" id="f-time" placeholder="æ‘˜è¦æ™‚é–“" class="p-2 text-xs rounded-lg border outline-none">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" id="f-from" placeholder="å‡ºç™¼åœ°" class="p-2 text-xs rounded-lg border outline-none">
                    <input type="text" id="f-to" placeholder="ç›®çš„åœ°" class="p-2 text-xs rounded-lg border outline-none">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="f-gate" placeholder="ç™»æ©Ÿé–€" class="p-2 text-xs rounded-lg border outline-none">
                    <input type="text" id="f-seat" placeholder="åº§ä½" class="p-2 text-xs rounded-lg border outline-none">
                </div>
                <button onclick="addFlight()" class="w-full bg-[#6B705C] text-white py-2 rounded-lg text-xs font-bold">å„²å­˜èˆªç­</button>
            </div>
            <div id="flights-list"></div>

            <div class="h-6"></div>

            <div class="flex justify-between items-center mb-3 px-1">
                <h3 class="text-sm font-black text-[#4A4E40]">å…¥ä½é£¯åº— ğŸ¨</h3>
                <button onclick="toggleSection('hotel')" class="text-[10px] bg-[#DDB892] text-white px-3 py-1 rounded-full font-bold">ï¼‹æ–°å¢é£¯åº—</button>
            </div>

            <div id="hotel-grid" class="expand-panel app-card p-4 mb-4 bg-gray-50 border-2 border-dashed border-[#DDB892]">
                <input type="text" id="h-name" placeholder="é£¯åº—åç¨±" class="w-full p-2 text-xs rounded-lg border outline-none mb-2">
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="h-room" placeholder="æˆ¿å‹" class="p-2 text-xs rounded-lg border outline-none">
                    <input type="date" id="h-checkin" class="p-2 text-xs rounded-lg border outline-none">
                </div>
                <button onclick="addHotel()" class="w-full bg-[#DDB892] text-white py-2 rounded-lg text-xs font-bold">å„²å­˜é£¯åº—</button>
            </div>
            <div id="hotels-list"></div>
        </div>

        <!-- åˆ†é ï¼šè¡Œç¨‹è¡¨ (Itinerary) -->
        <div id="content-itinerary" class="tab-content">
            <div class="app-card p-4 bg-white/80 mb-4 border-dashed border-2 border-gray-200">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" id="it-day" placeholder="Day 1" class="bg-gray-50 p-2 rounded-lg text-xs outline-none font-bold">
                    <input type="time" id="it-time" class="bg-gray-50 p-2 rounded-lg text-xs outline-none font-bold">
                </div>
                <div class="flex gap-2 mb-2">
                    <select id="it-type" class="w-1/3 bg-gray-50 p-2 rounded-lg text-xs font-bold outline-none border-none">
                        <option value="view">ğŸ“¸ æ™¯é»</option><option value="food">ğŸ´ ç¾é£Ÿ</option>
                        <option value="massage">ğŸ’† æŒ‰æ‘©</option><option value="shop">ğŸ›ï¸ è³¼ç‰©</option>
                    </select>
                    <input type="text" id="it-activity" placeholder="è¦å»å“ªè£¡ç©ï¼Ÿ" class="w-2/3 bg-gray-50 p-2 rounded-lg text-xs outline-none">
                </div>
                <button onclick="addItinerary()" class="bg-[#4A4E40] text-white w-full py-2.5 rounded-lg font-bold text-xs">åŠ å…¥è¡Œç¨‹</button>
            </div>
            <div id="it-list"></div>
        </div>

        <!-- åˆ†é ï¼šæ”¯å‡ºçµ±è¨ˆ (Budget) -->
        <div id="content-budget" class="tab-content hidden">
            <!-- ç¸½é¡å¡ç‰‡ -->
            <div class="app-card bg-[#6B705C] p-5 text-white mb-4">
                <div class="flex justify-between items-end mb-4">
                    <div class="text-left">
                        <p id="total-label" class="text-[9px] opacity-70 uppercase font-bold tracking-widest">Total Spent</p>
                        <h2 id="total-amount" class="text-3xl font-black italic">à¸¿ 0</h2>
                    </div>
                    <div class="text-right">
                        <p class="text-[9px] opacity-70 font-bold">ä¼°è¨ˆåŒ¯ç‡ 0.95</p>
                    </div>
                </div>
                
                <div class="bg-black/10 rounded-xl p-3 flex items-center gap-3">
                    <div class="flex-1">
                        <p class="text-[8px] opacity-60 font-bold mb-1 uppercase">THB æ³°éŠ–</p>
                        <input type="number" oninput="calcExchange(this.value)" placeholder="è¼¸å…¥æ³°éŠ–" class="w-full bg-transparent text-sm font-bold border-b border-white/20 outline-none">
                    </div>
                    <div class="text-xl opacity-30">â†’</div>
                    <div class="flex-1 text-right">
                        <p class="text-[8px] opacity-60 font-bold mb-1 uppercase">TWD å°å¹£</p>
                        <div id="exchange-result" class="text-sm font-black">$ 0</div>
                    </div>
                </div>
            </div>

            <!-- ä»˜æ¬¾äººéæ¿¾åˆ‡æ› -->
            <div class="flex gap-2 mb-4 overflow-x-auto pb-1 no-scrollbar">
                <button onclick="setPayerFilter('all')" id="chip-all" class="filter-chip active flex-shrink-0">å…¨éƒ¨</button>
                <button onclick="setPayerFilter('tina')" id="chip-tina" class="filter-chip flex-shrink-0 flex items-center gap-1">
                    Tina ğŸ’° <span id="chip-tina-amt" class="opacity-60 text-[9px]">à¸¿0</span>
                </button>
                <button onclick="setPayerFilter('darren')" id="chip-darren" class="filter-chip flex-shrink-0 flex items-center gap-1">
                    Darren ğŸ’³ <span id="chip-darren-amt" class="opacity-60 text-[9px]">à¸¿0</span>
                </button>
            </div>

            <!-- æ–°å¢æ”¯å‡º -->
            <div class="app-card p-4 space-y-2">
                <div class="grid grid-cols-2 gap-2">
                    <select id="exp-payer" class="bg-gray-50 p-2 rounded-lg text-xs outline-none font-bold">
                        <option value="tina">Tina è²·å–® ğŸ’°</option>
                        <option value="darren">Darren è²·å–® ğŸ’³</option>
                    </select>
                    <div class="flex gap-2">
                        <input type="number" id="exp-cost" placeholder="é‡‘é¡" class="flex-1 bg-gray-50 p-2 rounded-lg text-xs outline-none">
                        <select id="exp-currency" class="bg-gray-50 px-2 rounded-lg text-xs font-bold"><option value="THB">à¸¿</option><option value="TWD">$</option></select>
                    </div>
                </div>
                <input type="text" id="exp-item" placeholder="èŠ±è²»é …ç›®" class="w-full bg-gray-50 p-2 rounded-lg text-xs outline-none">
                <button onclick="addExpense()" class="bg-[#DDB892] text-white w-full py-2.5 rounded-lg font-bold text-xs">ç´€éŒ„æ”¯å‡º</button>
            </div>
            <div id="exp-list" class="mt-4"></div>
        </div>

        <!-- åˆ†é ï¼šè¡Œææ¸…å–® (Packing) -->
        <div id="content-packing" class="tab-content hidden">
            <div class="app-card p-4 mb-4">
                <div class="flex gap-2 mb-2">
                    <input type="text" id="pack-item" placeholder="æº–å‚™ç‰©å“..." class="flex-1 bg-gray-50 p-2 rounded-lg text-xs outline-none">
                    <select id="pack-owner" class="bg-gray-50 px-2 rounded-lg text-xs font-bold">
                        <option value="tina">Tina's</option>
                        <option value="darren">Darren's</option>
                    </select>
                </div>
                <button onclick="addPacking()" class="bg-[#6B705C] text-white w-full py-2.5 rounded-lg font-bold text-xs">åŠ å…¥æ¸…å–®</button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div><p class="text-[10px] font-bold text-[#E6BEBB] mb-1 ml-1 uppercase">Tina's Bag</p><div id="pk-list-tina" class="app-card"></div></div>
                <div><p class="text-[10px] font-bold text-[#8A9AAB] mb-1 ml-1 uppercase">Darren's Bag</p><div id="pk-list-darren" class="app-card"></div></div>
            </div>
        </div>
    </main>

    <!-- AI æ”»ç•¥ Modal -->
    <div id="gemini-modal" onclick="if(event.target === this) toggleGemini()">
        <div id="gemini-panel" onclick="event.stopPropagation()">
            <div class="p-6 h-full flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-black text-sm tracking-widest">âœ¨ AI èœœæœˆåŠ©æ‰‹</h3>
                    <div class="flex gap-3">
                        <button onclick="clearGemini()" class="text-[10px] text-gray-400 font-bold border px-2 py-1 rounded-lg">æ¸…ç©º</button>
                        <button onclick="toggleGemini()" class="text-xl">âœ•</button>
                    </div>
                </div>
                <div id="gemini-chat" class="flex-1 overflow-y-auto mb-4 space-y-4 text-xs"></div>
                <div class="flex gap-2 p-2 bg-gray-100 rounded-xl">
                    <input type="text" id="gemini-input" placeholder="å•å•çœ‹æ™¯é»æ”»ç•¥..." class="flex-1 p-2 text-xs outline-none bg-transparent">
                    <button onclick="askGemini()" class="bg-[#4A4E40] text-white px-4 rounded-lg text-xs font-bold">ç™¼é€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°è¦½ -->
    <nav class="bottom-nav">
        <div onclick="switchTab('core')" id="btn-core" class="nav-btn btn-press opacity-30">ğŸ›«</div>
        <div onclick="switchTab('itinerary')" id="btn-itinerary" class="nav-btn btn-press">ğŸ—ºï¸</div>
        <div onclick="switchTab('packing')" id="btn-packing" class="nav-btn btn-press opacity-30">ğŸ’</div>
        <div onclick="switchTab('budget')" id="btn-budget" class="nav-btn btn-press opacity-30">ğŸ’°</div>
        <div onclick="toggleGemini()" class="nav-btn btn-press">âœ¨</div>
    </nav>

    <script>switchTab('itinerary');</script>
</body>
</html>
