<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Darren & Tina 2026</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&family=Montserrat:wght@400;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --morandi-olive: #6B705C;
            --morandi-beige: #B7B7A4;
            --morandi-gold: #DDB892;
            --morandi-text: #4A4E40;
            --bg-light: #F8F7F2;
            --heart-pink: #F8AD9D;
        }

        body { 
            font-family: 'Montserrat', 'Noto Sans TC', sans-serif; 
            background-color: var(--bg-light); 
            color: var(--morandi-text); 
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .heart-text { 
            color: var(--heart-pink); 
            font-size: 0.75rem; 
            letter-spacing: 0.5em; 
            font-weight: 800; 
            margin-bottom: 0.5rem; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .couple-name { 
            font-family: 'Playfair Display', serif; 
            font-size: 2.2rem; 
            line-height: 1.1; 
            font-weight: 700; 
            color: #2D3128; 
            letter-spacing: 0.05em;
            margin: 0.5rem 0; 
        }
        .ampersand { font-family: sans-serif !important; font-weight: 400; margin: 0 4px; }
        
        .main-header {
            background: white;
            padding: 2.5rem 1rem 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.03);
        }

        .app-card {
            background: white;
            border-radius: 1.2rem;
            box-shadow: 0 4px 12px -5px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.8);
        }

        .bottom-nav {
            background: rgba(74, 78, 64, 0.95);
            backdrop-filter: blur(15px);
            position: fixed;
            bottom: 25px; left: 15px; right: 15px;
            border-radius: 2rem;
            height: 60px;
            z-index: 1000;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .nav-btn { font-size: 1.1rem; cursor: pointer; transition: opacity 0.2s; padding: 10px; }
        .btn-press:active { transform: scale(0.95); }

        #gemini-modal {
            position: fixed; inset: 0; z-index: 2000;
            background: rgba(0,0,0,0.3);
            visibility: hidden; opacity: 0; transition: opacity 0.3s ease;
        }
        #gemini-modal.open { visibility: visible; opacity: 1; }
        #gemini-panel {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 85%; background: #F8F7F2; border-radius: 2rem 2rem 0 0;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1);
        }
        #gemini-modal.open #gemini-panel { transform: translateY(0); }

        .tag { font-size: 10px; font-weight: 900; padding: 2px 8px; border-radius: 6px; margin-right: 4px; display: inline-block; margin-bottom: 4px; }
        .tag-type { background: #F3F4F6; color: #4B5563; border: 1px solid #E5E7EB; }

        input, select, textarea { font-size: 16px !important; } 

        .filter-chip {
            padding: 10px 14px; border-radius: 1.2rem; font-size: 10px; font-weight: 700;
            background: white; border: 1px solid #E5E7EB; color: #9CA3AF; transition: all 0.2s;
            text-align: left; min-width: 110px;
        }
        .filter-chip.active { background: #6B705C; border-color: #6B705C; color: white; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .expand-panel { display: none; margin-top: 10px; }
        .expand-panel.active { display: block; }

        .flight-path { position: relative; height: 1px; background: #E5E7EB; flex: 1; margin: 0 10px; }
        .flight-path::after { content: 'âœˆï¸'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 10px; }

        .weather-card {
            background: linear-gradient(135deg, #8E9775 0%, #6B705C 100%);
            color: white; border-radius: 1.2rem; padding: 1.2rem; margin-bottom: 1.5rem;
        }

        .action-link {
            font-size: 10px; font-weight: 800; color: #8E9775;
            padding: 6px 10px; border: 1.5px solid #E5E7EB; border-radius: 8px;
            display: inline-flex; align-items: center; gap: 4px;
            background: white;
        }

        .converter-box {
            background: #f1f3ef;
            border-radius: 1rem;
            padding: 1rem;
            border: 1px dashed #B7B7A4;
        }

        .thinking-dots::after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, collection, addDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

        // --- Firebase Initial ---
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let user = null;
        let allExpenses = [];
        let currentPayerFilter = 'all';

        const ratesToTHB = { 'THB': 1, 'TWD': 1.05, 'USD': 35.5 };
        const thbToTWD = 0.95;

        // --- Auth Setup ---
        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };
        initAuth();

        onAuthStateChanged(auth, (u) => {
            user = u;
            if (u) startSyncing();
        });

        // --- Data Fetching ---
        function startSyncing() {
            if (!user) return;
            const getPath = (coll) => collection(db, 'artifacts', appId, 'public', 'data', coll);

            onSnapshot(getPath('itinerary'), (s) => renderItinerary(s.docs.map(d => ({id: d.id, ...d.data()}))), (err) => console.error(err));
            onSnapshot(getPath('packing'), (s) => renderPacking(s.docs.map(d => ({id: d.id, ...d.data()}))), (err) => console.error(err));
            onSnapshot(getPath('flights'), (s) => renderFlights(s.docs.map(d => ({id: d.id, ...d.data()}))), (err) => console.error(err));
            onSnapshot(getPath('hotels'), (s) => renderHotels(s.docs.map(d => ({id: d.id, ...d.data()}))), (err) => console.error(err));
            onSnapshot(getPath('expenses'), (s) => {
                allExpenses = s.docs.map(d => ({id: d.id, ...d.data()}));
                renderExpenses();
            }, (err) => console.error(err));
        }

        // --- Render Functions ---
        function renderItinerary(items) {
            document.getElementById('it-list').innerHTML = items.sort((a,b)=>a.day.localeCompare(b.day)||a.time.localeCompare(b.time)).map(item => `
                <div class="app-card p-4 flex flex-col gap-3 mb-3">
                    <div class="flex gap-4 items-start">
                        <div class="flex flex-col items-center bg-[#F5F5F3] p-2 rounded-lg min-w-[55px]">
                            <span class="text-[9px] font-bold text-gray-400">${item.day}</span>
                            <span class="text-sm font-black text-[#6B705C]">${item.time}</span>
                        </div>
                        <div class="flex-1">
                            <div class="mb-1"><span class="tag tag-type">${item.type === 'food' ? 'ğŸ´ ç¾é£Ÿ' : 'ğŸ“¸ æ™¯é»'}</span></div>
                            <div class="font-bold text-[#4A4E40] text-sm">${item.activity}</div>
                        </div>
                        <button onclick="window.deleteItem('itinerary', '${item.id}')" class="text-gray-200">âœ•</button>
                    </div>
                    <div class="flex flex-wrap gap-2 pt-2 border-t border-gray-50">
                        <button onclick="window.askGemini('å¹«æˆ‘è¦åŠƒå‰å¾€ ${item.activity} çš„äº¤é€šè·¯ç·šèˆ‡å°èˆªå»ºè­°')" class="action-link">ğŸ“ è·¯ç·šå°èˆª</button>
                        <button onclick="window.askGemini('è«‹é‡å° ${item.activity} è¦åŠƒè©³ç´°æ”»ç•¥')" class="action-link">ğŸ’¡ æŸ¥çœ‹æ”»ç•¥</button>
                    </div>
                </div>`).join('');
        }

        function renderFlights(items) {
            document.getElementById('flights-list').innerHTML = items.map(f => `
                <div class="app-card p-5 mb-3">
                    <div class="flex justify-between items-center mb-4">
                        <span class="bg-[#6B705C] text-white text-[9px] px-2 py-0.5 rounded font-black">${f.code}</span>
                        <div class="flex gap-2">
                             <span class="text-[9px] font-bold text-gray-400">Seat: ${f.seat || '--'}</span>
                             <button onclick="window.deleteItem('flights', '${f.id}')" class="text-gray-200 text-xs">âœ•</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-center flex-1">
                            <div class="text-lg font-black text-[#2D3128]">${f.from}</div>
                            <div class="text-xs font-bold text-[#6B705C]">${f.depTime || '--:--'}</div>
                        </div>
                        <div class="flight-path"></div>
                        <div class="text-center flex-1">
                            <div class="text-lg font-black text-[#2D3128]">${f.to}</div>
                            <div class="text-xs font-bold text-[#6B705C]">${f.arrTime || '--:--'}</div>
                        </div>
                    </div>
                </div>`).join('');
        }

        function renderHotels(items) {
            document.getElementById('hotels-list').innerHTML = items.map(h => `
                <div class="app-card p-4 mb-3 flex justify-between items-center">
                    <div class="flex-1">
                        <div class="text-xs font-black text-[#4A4E40]">${h.name}</div>
                        <div class="text-[10px] text-gray-400 font-bold mt-1">æˆ¿è™Ÿ: ${h.room || '--'} | å…¥ä½: ${h.checkin || '--'}</div>
                    </div>
                    <button onclick="window.deleteItem('hotels', '${h.id}')" class="text-gray-200 text-xs pl-4">âœ•</button>
                </div>`).join('');
        }

        function renderExpenses() {
            let totalsByPayer = { tina: {}, darren: {} };
            allExpenses.forEach(e => { 
                if(!totalsByPayer[e.payer]) totalsByPayer[e.payer] = {};
                if(!totalsByPayer[e.payer][e.currency]) totalsByPayer[e.payer][e.currency] = 0;
                totalsByPayer[e.payer][e.currency] += e.cost;
            });
            const formatPayerSummary = (p) => {
                let lines = [];
                for(let curr in totalsByPayer[p]) lines.push(`${curr} ${Math.round(totalsByPayer[p][curr]).toLocaleString()}`);
                return lines.length > 0 ? lines.join(' / ') : 'å°šæœªæ”¯å‡º';
            };
            document.getElementById('chip-tina-amt').innerText = formatPayerSummary('tina');
            document.getElementById('chip-darren-amt').innerText = formatPayerSummary('darren');
            
            const filtered = currentPayerFilter === 'all' ? allExpenses : allExpenses.filter(e => e.payer === currentPayerFilter);
            const totalSum = filtered.reduce((s, e) => s + (e.cost * (ratesToTHB[e.currency] || 1)), 0);
            document.getElementById('total-amount').innerText = 'à¸¿ ' + Math.round(totalSum).toLocaleString();
            
            document.getElementById('exp-list').innerHTML = filtered.map(exp => `
                <div class="app-card p-3 flex justify-between items-center mb-2 border-l-4 ${exp.payer==='tina'?'border-[#F8AD9D]':'border-[#6B705C]'}">
                    <div class="flex-1 pr-4">
                        <div class="text-xs font-bold text-[#4A4E40]">${exp.item}</div>
                        <div class="text-[9px] text-gray-400 mt-0.5 font-bold uppercase tracking-tighter">${exp.payer==='tina'?'Tina ğŸ’°':'Darren ğŸ’³'} â€¢ ${exp.currency} ${exp.cost.toLocaleString()}</div>
                    </div>
                    <div class="text-right"><div class="text-sm font-black text-[#2D3128]">à¸¿ ${Math.round(exp.cost * (ratesToTHB[exp.currency] || 1)).toLocaleString()}</div></div>
                    <button onclick="window.deleteItem('expenses', '${exp.id}')" class="text-gray-100 ml-3 text-[10px]">âœ•</button>
                </div>`).join('');
        }

        function renderPacking(items) {
            const draw = (o, t) => {
                document.getElementById(t).innerHTML = items.filter(i => i.owner === o).map(i => `
                    <div class="p-3 flex items-center gap-3 border-b border-gray-50">
                        <div onclick="window.togglePack('${i.id}', ${i.checked})" class="w-4 h-4 rounded border ${i.checked ? 'bg-[#6B705C] border-[#6B705C]' : 'border-gray-200'}"></div>
                        <span class="flex-1 text-xs ${i.checked ? 'line-through text-gray-300' : 'font-bold'}">${i.item}</span>
                        <button onclick="window.deleteItem('packing', '${i.id}')" class="text-gray-200">âœ•</button>
                    </div>`).join('');
            };
            draw('tina', 'pk-list-tina'); draw('darren', 'pk-list-darren');
        }

        // --- Global Actions ---
        window.addItinerary = async () => {
            if (!user) return;
            const act = document.getElementById('it-activity').value; if(!act) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'itinerary'), { 
                day: document.getElementById('it-day').value || 'Day 1', 
                time: document.getElementById('it-time').value || '12:00', 
                activity: act, 
                type: document.getElementById('it-type').value 
            });
            document.getElementById('it-activity').value = '';
        };

        window.addExpense = async () => {
            if (!user) return;
            const item = document.getElementById('exp-item').value;
            const cost = parseFloat(document.getElementById('exp-cost').value);
            if (!item || isNaN(cost)) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), {
                item, cost,
                currency: document.getElementById('exp-currency').value,
                payer: document.getElementById('exp-payer').value,
                createdAt: Date.now()
            });
            document.getElementById('exp-item').value = '';
            document.getElementById('exp-cost').value = '';
            document.getElementById('exchange-hint').innerText = '';
        };

        window.addFlight = async () => {
            if (!user) return;
            const code = document.getElementById('f-code').value; if (!code) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'flights'), {
                code, from: document.getElementById('f-from').value, to: document.getElementById('f-to').value,
                depTime: document.getElementById('f-depTime').value, arrTime: document.getElementById('f-arrTime').value,
                seat: document.getElementById('f-seat').value
            });
            document.getElementById('f-code').value = ''; window.toggleSection('flight');
        };

        window.addHotel = async () => {
            if (!user) return;
            const name = document.getElementById('h-name').value; if (!name) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'hotels'), {
                name, room: document.getElementById('h-room').value, checkin: document.getElementById('h-checkin').value
            });
            document.getElementById('h-name').value = ''; window.toggleSection('hotel');
        };

        window.addPacking = async () => {
            if (!user) return;
            const val = document.getElementById('pack-item').value; if(!val) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'packing'), {
                item: val, owner: document.getElementById('pack-owner').value, checked: false
            });
            document.getElementById('pack-item').value = '';
        };

        window.deleteItem = async (coll, id) => {
            if (!user) return;
            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', coll, id));
        };

        window.togglePack = async (id, s) => {
            if (!user) return;
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'packing', id), { checked: !s });
        };

        window.calcIndependentRate = () => {
            const val = parseFloat(document.getElementById('conv-input').value) || 0;
            const curr = document.getElementById('conv-curr').value;
            const res = document.getElementById('conv-res');
            if (curr === 'THB') res.innerText = `å°å¹£ NT$ ${Math.round(val * thbToTWD).toLocaleString()}`;
            else res.innerText = `æ³°éŠ– à¸¿ ${Math.round(val * (ratesToTHB[curr] || 1)).toLocaleString()}`;
        };

        window.updateExchangePreview = () => {
            const cost = parseFloat(document.getElementById('exp-cost').value) || 0;
            const curr = document.getElementById('exp-currency').value;
            const hint = document.getElementById('exchange-hint');
            hint.innerText = curr === 'THB' ? '' : `â‰ˆ à¸¿ ${Math.round(cost * (ratesToTHB[curr] || 1)).toLocaleString()}`;
        };

        window.askGemini = async (q = null) => {
            const input = document.getElementById('gemini-input');
            const chat = document.getElementById('gemini-chat');
            const queryText = q || input.value.trim(); if(!queryText) return;
            window.toggleGemini(true);
            if(!q) input.value = '';
            chat.innerHTML += `<div class="mb-4 text-right"><span class="inline-block bg-[#6B705C] text-white p-2 rounded-lg text-xs font-bold">${queryText}</span></div>`;
            const thinkingId = 'think-' + Date.now();
            chat.innerHTML += `<div id="${thinkingId}" class="mb-4 text-left"><div class="inline-block bg-white p-3 rounded-lg text-xs italic">åŠ©ç†æ€è€ƒä¸­...</div></div>`;
            chat.scrollTop = chat.scrollHeight;

            try {
                // ä¿®æ­£é‡é»ï¼šæ˜ç¢ºè¦æ±‚ Gemini ä½¿ç”¨ç¹é«”ä¸­æ–‡å›è¦†
                const systemPrompt = "ä½ æ˜¯ Darren & Tina çš„èœœæœˆåŠ©æ‰‹ã€‚è«‹è¦ªåˆ‡åœ°å›è¦†ã€‚è«‹å‹™å¿…ä½¿ç”¨ç¹é«”ä¸­æ–‡ï¼ˆå°ç£ç¿’æ…£ç”¨èªï¼‰å›è¦†æ‰€æœ‰å…§å®¹ã€‚";
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: queryText }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });
                const data = await res.json();
                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "å°ä¸èµ·ï¼Œæˆ‘æš«æ™‚æ–·ç·šäº†ã€‚";
                document.getElementById(thinkingId)?.remove();
                chat.innerHTML += `<div class="mb-4 text-left"><div class="inline-block bg-white p-3 rounded-lg text-xs shadow-sm border text-[#4A4E40]">${reply.replace(/\n/g, '<br>')}</div></div>`;
            } catch (e) {
                document.getElementById(thinkingId)?.remove();
            }
            chat.scrollTop = chat.scrollHeight;
        };

        window.setPayerFilter = (p) => { currentPayerFilter = p; document.querySelectorAll('.filter-chip').forEach(el => el.classList.toggle('active', el.id === 'chip-'+p)); renderExpenses(); };
        window.toggleSection = (id) => { document.getElementById(id+'-grid').classList.toggle('active'); };
        window.toggleGemini = (f = false) => { const m = document.getElementById('gemini-modal'); if(f) m.classList.add('open'); else m.classList.toggle('open'); };
        window.switchTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('content-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.add('opacity-30'));
            document.getElementById('btn-'+id).classList.remove('opacity-30');
        };
        window.switchTab('itinerary'); // Default tab
        window.clearGemini = () => { document.getElementById('gemini-chat').innerHTML = ''; };

    </script>
</head>
<body class="pb-24">
    <header class="main-header">
        <div class="heart-text"><span>â™¥</span> SWEET GETAWAY <span>â™¥</span></div>
        <h1 class="couple-name">DARREN <span class="ampersand">&</span> TINA</h1>
        <p class="text-[9px] font-black text-[#8E9775] mt-1 tracking-[0.2em] uppercase">2026 Bangkok Phuket ğŸ‡¹ğŸ‡­âœˆï¸</p>
    </header>

    <main class="max-w-md mx-auto p-4">
        
        <!-- è¡Œç¨‹è¡¨ -->
        <div id="content-itinerary" class="tab-content">
            <div class="weather-card flex justify-between items-center shadow-lg" onclick="window.askGemini('å¹«æˆ‘æŸ¥æ³°åœ‹æ›¼è°·èˆ‡æ™®å‰å³¶çš„å¤©æ°£æ¦‚æ³èˆ‡å»ºè­°ã€‚')">
                <div>
                    <div class="text-[10px] font-bold opacity-80 uppercase tracking-widest mb-1">Live Weather</div>
                    <div class="text-lg font-black">æ›¼è°· 31Â°C / æ™®å‰ 29Â°C</div>
                    <div class="text-[9px] mt-1 font-bold opacity-60">é»æ“ŠæŸ¥çœ‹ AI ç©¿æ­èˆ‡é˜²æ›¬å»ºè­° âœ¨</div>
                </div>
                <div class="text-3xl">â˜€ï¸</div>
            </div>
            <div class="app-card p-4 bg-white/80 mb-4 border-dashed border-2 border-gray-200">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" id="it-day" placeholder="Day 1" class="bg-gray-50 p-2 rounded-lg text-xs outline-none font-bold">
                    <input type="time" id="it-time" class="bg-gray-50 p-2 rounded-lg text-xs outline-none font-bold">
                </div>
                <div class="flex gap-2 mb-2">
                    <select id="it-type" class="w-1/3 bg-gray-50 p-2 rounded-lg text-xs font-bold outline-none">
                        <option value="view">ğŸ“¸ æ™¯é»</option>
                        <option value="food">ğŸ´ ç¾é£Ÿ</option>
                    </select>
                    <input type="text" id="it-activity" placeholder="ç›®çš„åœ°åç¨±" class="w-2/3 bg-gray-50 p-2 rounded-lg text-xs outline-none font-bold">
                </div>
                <button onclick="window.addItinerary()" class="bg-[#4A4E40] text-white w-full py-2.5 rounded-lg font-bold text-xs">åŠ å…¥è¡Œç¨‹</button>
            </div>
            <div id="it-list"></div>
        </div>

        <!-- äº¤é€šä½å®¿ -->
        <div id="content-core" class="tab-content hidden">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-black text-[#4A4E40]">èˆªç­è³‡è¨Š âœˆï¸</h3>
                <button onclick="window.toggleSection('flight')" class="text-[10px] bg-[#6B705C] text-white px-3 py-1 rounded-full font-bold">ï¼‹æ–°å¢</button>
            </div>
            <div id="flight-grid" class="expand-panel app-card p-4 mb-4 bg-gray-50">
                <input type="text" id="f-code" placeholder="èˆªç­è™Ÿ (å¦‚ TG635)" class="w-full p-2 text-xs rounded-lg border mb-2 font-bold">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" id="f-from" placeholder="å‡ºç™¼åœ°" class="p-2 text-xs rounded-lg border">
                    <input type="text" id="f-to" placeholder="ç›®çš„åœ°" class="p-2 text-xs rounded-lg border">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="time" id="f-depTime" class="p-2 text-xs rounded-lg border">
                    <input type="time" id="f-arrTime" class="p-2 text-xs rounded-lg border">
                </div>
                <input type="text" id="f-seat" placeholder="åº§ä½è™Ÿ" class="w-full p-2 text-xs rounded-lg border mb-3">
                <button onclick="window.addFlight()" class="w-full bg-[#6B705C] text-white py-2 rounded-lg text-xs font-bold">å„²å­˜èˆªç­</button>
            </div>
            <div id="flights-list"></div>
            
            <div class="flex justify-between items-center mt-6 mb-3">
                <h3 class="text-sm font-black text-[#4A4E40]">å…¥ä½é£¯åº— ğŸ¨</h3>
                <button onclick="window.toggleSection('hotel')" class="text-[10px] bg-[#DDB892] text-white px-3 py-1 rounded-full font-bold">ï¼‹æ–°å¢</button>
            </div>
            <div id="hotel-grid" class="expand-panel app-card p-4 mb-4 bg-gray-50">
                <input type="text" id="h-name" placeholder="é£¯åº—åç¨±" class="w-full p-2 text-xs rounded-lg border mb-2 font-bold">
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="h-room" placeholder="æˆ¿è™Ÿ" class="p-2 text-xs rounded-lg border">
                    <input type="date" id="h-checkin" class="p-2 text-xs rounded-lg border">
                </div>
                <button onclick="window.addHotel()" class="w-full bg-[#DDB892] text-white py-2 rounded-lg text-xs font-bold">å„²å­˜é£¯åº—</button>
            </div>
            <div id="hotels-list"></div>
        </div>

        <!-- æ”¯å‡ºçµ±è¨ˆ (å®Œæ•´æ”¯ä»˜å€å¡Š) -->
        <div id="content-budget" class="tab-content hidden">
            <div class="converter-box mb-6">
                <p class="text-[10px] font-black text-[#6B705C] mb-2 uppercase tracking-widest">âš¡ å¿«é€ŸåŒ¯ç‡æ›ç®—</p>
                <div class="flex gap-2 items-center">
                    <input type="number" id="conv-input" placeholder="è¼¸å…¥é‡‘é¡" oninput="window.calcIndependentRate()" class="flex-1 bg-white p-2 rounded-lg text-xs outline-none font-bold">
                    <select id="conv-curr" onchange="window.calcIndependentRate()" class="bg-white p-2 rounded-lg text-xs font-black outline-none">
                        <option value="TWD">TWD å°å¹£</option>
                        <option value="USD">USD ç¾é‡‘</option>
                        <option value="THB">THB æ³°éŠ–</option>
                    </select>
                </div>
                <div id="conv-res" class="mt-2 text-sm font-black text-[#4A4E40] italic">æ³°éŠ– à¸¿ 0</div>
            </div>

            <div class="app-card bg-[#6B705C] p-5 text-white mb-4 relative overflow-hidden">
                <p class="text-[9px] opacity-70 uppercase font-bold tracking-widest">Honeymoon Total (THB)</p>
                <h2 id="total-amount" class="text-3xl font-black italic">à¸¿ 0</h2>
                <div class="absolute right-[-10px] bottom-[-10px] text-6xl opacity-10">ğŸ’°</div>
            </div>
            
            <div class="flex gap-3 mb-4 overflow-x-auto pb-1 no-scrollbar">
                <button onclick="window.setPayerFilter('all')" id="chip-all" class="filter-chip active flex-shrink-0">å…¨éƒ¨æ”¯å‡º</button>
                <button onclick="window.setPayerFilter('tina')" id="chip-tina" class="filter-chip flex-shrink-0">
                    <div class="font-black">Tina</div>
                    <div id="chip-tina-amt" class="text-[8px] font-bold mt-1 opacity-70"></div>
                </button>
                <button onclick="window.setPayerFilter('darren')" id="chip-darren" class="filter-chip flex-shrink-0">
                    <div class="font-black">Darren</div>
                    <div id="chip-darren-amt" class="text-[8px] font-bold mt-1 opacity-70"></div>
                </button>
            </div>

            <div class="app-card p-4 space-y-3">
                <div class="flex flex-col gap-2">
                    <input type="text" id="exp-item" placeholder="é€™æ˜¯èŠ±äº†ä»€éº¼ï¼Ÿ" class="w-full bg-gray-50 p-2.5 rounded-xl text-xs outline-none">
                    <select id="exp-payer" class="w-full bg-gray-100 p-2.5 rounded-xl text-[10px] font-black">
                        <option value="tina">Tina éœ¸æ°£è²·å–® ğŸ’°</option>
                        <option value="darren">Darren è­·å¦»ç¥åˆ· ğŸ’³</option>
                    </select>
                </div>
                <div class="flex gap-2 items-center">
                    <select id="exp-currency" onchange="window.updateExchangePreview()" class="bg-gray-50 p-2.5 rounded-xl text-xs font-bold outline-none"><option value="THB">THB</option><option value="TWD">TWD</option><option value="USD">USD</option></select>
                    <div class="flex-1 relative">
                        <input type="number" id="exp-cost" oninput="window.updateExchangePreview()" placeholder="é‡‘é¡" class="w-full bg-gray-50 p-2.5 rounded-xl text-xs outline-none font-bold">
                        <div id="exchange-hint" class="absolute right-3 top-1/2 -translate-y-1/2 text-[9px] text-gray-400 font-bold italic"></div>
                    </div>
                </div>
                <button onclick="window.addExpense()" class="w-full bg-[#2D3128] text-white py-3 rounded-xl text-xs font-black tracking-widest mt-2">æ–° å¢ è¨˜ å¸³</button>
            </div>
            <div id="exp-list" class="mt-4"></div>
        </div>

        <!-- è¡Œææ¸…å–® -->
        <div id="content-packing" class="tab-content hidden">
            <div class="app-card p-4 mb-4">
                <div class="flex gap-2 mb-2">
                    <input type="text" id="pack-item" placeholder="æº–å‚™ç‰©å“..." class="flex-1 bg-gray-50 p-2 rounded-lg text-xs outline-none">
                    <select id="pack-owner" class="bg-gray-50 px-2 rounded-lg text-xs font-bold"><option value="tina">Tina</option><option value="darren">Darren</option></select>
                </div>
                <button onclick="window.addPacking()" class="bg-[#6B705C] text-white w-full py-2.5 rounded-lg font-bold text-xs">åŠ å…¥è¡Œææ¸…å–®</button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div><p class="text-[10px] font-bold text-[#F8AD9D] mb-1 ml-1 uppercase">Tina's</p><div id="pk-list-tina" class="app-card min-h-[50px]"></div></div>
                <div><p class="text-[10px] font-bold text-[#6B705C] mb-1 ml-1 uppercase">Darren's</p><div id="pk-list-darren" class="app-card min-h-[50px]"></div></div>
            </div>
        </div>
    </main>

    <!-- AI åŠ©ç† -->
    <div id="gemini-modal" onclick="if(event.target === this) window.toggleGemini()">
        <div id="gemini-panel" onclick="event.stopPropagation()">
            <div class="p-5 h-full flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <h3 class="font-black text-sm text-[#4A4E40]">âœ¨ èœœæœˆåŠ©ç†</h3>
                        <button onclick="window.clearGemini()" class="text-[9px] bg-gray-200 px-2 py-0.5 rounded-full text-gray-500 font-bold">æ¸…é™¤</button>
                    </div>
                    <button onclick="window.toggleGemini()" class="text-xl text-gray-300">âœ•</button>
                </div>
                <div id="gemini-chat" class="flex-1 overflow-y-auto mb-4 space-y-4 text-xs"></div>
                <div class="flex gap-2 p-2 bg-white rounded-xl shadow-inner border">
                    <input type="text" id="gemini-input" placeholder="å•å•æ³°åœ‹æ”»ç•¥..." class="flex-1 p-2 text-xs outline-none bg-transparent">
                    <button onclick="window.askGemini()" class="bg-[#6B705C] text-white px-4 rounded-lg text-xs font-bold">ç™¼é€</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div onclick="window.switchTab('core')" id="btn-core" class="nav-btn btn-press opacity-30">ğŸ›«</div>
        <div onclick="window.switchTab('itinerary')" id="btn-itinerary" class="nav-btn btn-press">ğŸ—ºï¸</div>
        <div onclick="window.switchTab('packing')" id="btn-packing" class="nav-btn btn-press opacity-30">ğŸ’</div>
        <div onclick="window.switchTab('budget')" id="btn-budget" class="nav-btn btn-press opacity-30">ğŸ’°</div>
        <div onclick="window.toggleGemini()" class="nav-btn btn-press">âœ¨</div>
    </nav>
</body>
</html>
